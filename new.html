<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport"
			content="width=350, initial-scale=1.0, maximum-scale=1.0, user-scalable=1.0, user-scalable=no">
		<meta http-equiv="pragma" content="no-cache">
		<meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
		<meta http-equiv="expires" content="Wed, 26 Feb 2007 08:21:57 GMT">
		<title>郑州大学数据中台2020</title>
		<link rel="stylesheet" type="text/css" href="./mycss.css">
		<style>
			#bak_0 {
				MARGIN: 0 auto;
				left: 0;
				WIDTH: 350px;
				min-HEIGHT: 540px;
			}
		</style>
		
		<script>
			function getQueryVariable(variable)
			{
				var query = window.location.search.substring(1);
				var vars = query.split("&");
				for (var i=0;i<vars.length;i++) {
					var pair = vars[i].split("=");
					if(pair[0] == variable){return pair[1];}
				}
				return(false);
			}
		
		</script>
		
		<script language="javascript">
			start = false;
			var timeID=0;
			var tt1=600;
			tt2=0;
			tt3=0;
			var timeID=setInterval("hnceTimer()",1000);
			function hnceTimer(){
				if(start){
					tt1--;
					if (tt1>=0){
					tt2=tt1 % 60;
					tt3=(tt1-tt2)/60;
					document.getElementById("tim317").innerHTML=tt3+"分"+tt2+"秒";
					}else{document.getElementById("tim317").innerHTML="已作废";}
				}
			}
		</script>
	</head>
	
	<body id="main_body">
		<div id="bak_0" style="color:white">
			<div style="WIDTH: 100%; HEIGHT: 102px;background:url(./images/title316b.png);">
				<div style="width:100%;height:32px;line-height:32px;text-align:right">
					<a href="https://jksb.v.zzu.edu.cn/vls6sss/zzujksb.dll/logout?ptopid=s1B91155D19B741238DC1233C96FFD7DC">
						<span style="color:#00c;">〖切换账号〗</span>
					</a>　
				</div>
			</div>
			
			<div style="width:100%;height:7px;BACKGROUND-IMAGE: url(./images/split5.png)"></div>
			
			<div style="WIDTH: 100%; HEIGHT: 90px;">
				<div style="width:100%;height:32%;line-height:32px;text-align:left;">
					<span style="font-size:12px;color:#333;">
						获取时间：
					</span>
					<span style="font-size:16px;color:#a0a;" id="datetimenow"> 10:00 </span>
					<span style="font-size:12px;color:#333;">
						有效期剩余
					</span>
					<span id="tim317" style="font-size:22px;color:#c00;font-weight:500;font-family:黑体;">
						10分00秒
					</span>
				</div>
				
				<div style="width:100%;height:7px;BACKGROUND-IMAGE: url(./images/split5.png)">
				</div>
				
				<div style="width:100%;min-height:25px;line-height:25px;font-size:18px;color:#00c;font-weight:500;font-family:黑体;">
					<span style="color:#00a" id="collageAndName">
						&nbsp;&nbsp;信息工程学院　XXX
					</span>
					<br>
					<span id="door">
						&nbsp;&nbsp;通行信息：主校区大门北门.<span style="color:yellow;background-color:#C526CE;font-weight:normal;border-top: 3px solid #C526CE;border-bottom: 3px solid #C526CE;">出口</span>
					</span>
					<br>
					<span id="m_identity">
						&nbsp;&nbsp;出入身份：请假被批准的学生
					</span>
					<img id="qrcode_image" src="./test.jpg" style="width:335px;border:8px solid #C526CE;">
				</div>
				
				<div style="width:100%;height:7px;BACKGROUND-IMAGE: url(./images/split5.png)">
				</div>
				<div style="width:100%;min-height:18px;line-height:18px;font-size:12px;color:#666;text-align:center">
					郑州大学疫情防控领导小组、保卫处、信息化办公室
				</div>
			</div>
		</div>
		
		<script type="text/javascript">
			document.querySelector("div[id='bak_0']").style.display='none';
		</script>
	
		<div id="bak_1" style="text-shadow: 1px 1px 1px #FFF;">
			<form>
				<div class="segment" style="padding:10px">
					<h1>张三の通行码</h1>
				</div>
				<div style="text-align:center">
					<img src="./test.jpg" id="image" width="180"  style="display:flex vertical-align:middle;box-shadow: -5px -5px 10px #FFF, 5px 5px 10px #BABECC;">
				</div>
				
			    <div class="input-group" style="padding-top:15px; padding-bottom:24px; ">
					<label>
					  <input name="f_name" type="text" placeholder="姓名：张三" style="width:150%"/>
					</label>
					<label for="f_image" class="unit" style="text-align:right;text-decoration:underline;color:#61677C">
						选择照片
					</label>
					<input id="f_image" type="file" onchange="handleFiles()">
			    </div>
				
				<label style="padding-top:0px;padding-bottom:0px;">
					<input name="f_collage" type="text" placeholder="院系：信息工程学院"/>

				</label>
				<label style="padding-top:0px;padding-bottom:0px;">
					<input name="f_door" type="text" placeholder="入口：主校区大门北门"/>
				</label>
				<label style="padding-top:0px;padding-bottom:0px;">
					<input name="f_identity" type="text" placeholder="出入身份：请假被批准的学生"/>
				</label>
				
				<div class="segment" style="padding-top:0px">
					<button class="unit" type="button" style="text-align:left;width:35%;color: #AE1100;" onclick="generate_out()">出校</button>

					
					<button class="unit" type="button" style="text-align:left;width:35%;color: #AE1100;" onclick="generate_in()">入校</button>
				</div>
				<div style="text-align:center">
					<button class="uint" type="button" onclick="window.location.href='./images/money.png'">赞赏</button>
					<button class="uint" type="button" onclick="windows.location.href='#'">教程</button>
					<button class="uint" type="button" onclick="window.open('mailto:sw3310@columbia.edu');">反馈</button>
					<button class="uint" type="button" onclick="window.open('mailto:sw3310@columbia.edu');">合作</button>
				</div>
			</form>
		</div> 
		<script type="text/javascript">
			if(localStorage.getItem("email")==null || localStorage.getItem("email")=="false" || localStorage.getItem("email")!=getQueryVariable("email")){
				document.querySelector("div[id='bak_1']").style.display='none';
			}
		</script>
		
	</body>	
	<!-- 配置时间 -->
	<script>
		let dta = new Date();
		document.getElementById("datetimenow").innerHTML = (("0"+(dta.getMonth()+1)).slice(-2)) +"月"+(("0"+dta.getDate()).slice(-2)) +"日" +" "+ (("0"+dta.getHours()).slice(-2)) +":"+ (("0"+dta.getMinutes()).slice(-2))+"      ";
	</script>
	
	
	<script>
		var img = document.getElementById("image");
		let showQRCodeEl = document.getElementById("qrcode_image");
		function handleFiles() {
			var filesToUpload = document.getElementById('f_image').files;
			var file = filesToUpload[0];
			let uploadImgSrc = window.URL.createObjectURL(file);
			showQRCodeEl.src = uploadImgSrc;
			img.src = uploadImgSrc;
			
			const reader = new FileReader();
			reader.onloadend = () => {
			    // convert file to base64 String
			    const base64String = reader.result.replace('data:', '').replace(/^.+,/, '');
			    // store file
			    localStorage.setItem('choosenQRcode', base64String);
			    
			};
			reader.readAsDataURL(file);
		}
	</script>
	
	<!-- 二次使用时读取localStroage进行内容填充 -->
	<script>
		a = localStorage.getItem('f_name');
		b = localStorage.getItem('f_collage');
		c = localStorage.getItem('f_door');
		d = localStorage.getItem('f_identity');
		e = localStorage.getItem('choosenQRcode');
		
		if(a!=null){
			document.querySelector("input[name='f_name']").value = a;
		}
		if(b!=null){
			document.querySelector("input[name='f_collage']").value = b;
		}
		if(c!=null){
			document.querySelector("input[name='f_door']").value=c;
		}
		if(d!=null){
			document.querySelector("input[name='f_identity']").value = d;
		}
		if(e!=null){
			document.getElementById("image").src = "data:image/png;base64,"+ e;
			document.getElementById("qrcode_image").src = "data:image/png;base64,"+ e;
		}
		
	</script>
	
	
	<script>
		let a=null;
		let b=null;
		let c=null;
		
		function generate(){
			start = true;	//star henceTimer
			//hide form and show passcode
			document.querySelector("div[id='bak_1']").style.display='none';
			document.querySelector("div[id='bak_0']").style.display='block';
			
			document.body.style.backgroundColor = "#FFFFFF";

			a = document.querySelector("input[name='f_name']").value;	//value from form
			b = document.querySelector("input[name='f_collage']").value;
			c = document.querySelector("input[name='f_door']").value;
			d = document.querySelector("input[name='f_identity']").value;
			localStorage.setItem('f_name', a);
			localStorage.setItem('f_collage', b);
			localStorage.setItem('f_door', c);
			localStorage.setItem('f_identity', d);
			
			document.querySelector("span[id='collageAndName']").innerHTML ="&nbsp;&nbsp;"+ b+"　"+a;
			document.querySelector("span[id='m_identity']").innerHTML = "&nbsp;&nbsp;出入身份："+d;
		}
		
		
		function generate_in(){
			generate();
			document.querySelector("span[id='door']").innerHTML = "&nbsp;&nbsp;通行信息："+c+'.<span style="color:yellow;background-color:green;font-weight:normal;border-top: 0px solid green;border-bottom: 0px solid green;">入口</span>';
			document.getElementById("qrcode_image").style.border="8px solid green";
		}
		
		function generate_out(){
			generate();
			document.querySelector("span[id='door']").innerHTML = "&nbsp;&nbsp;通行信息："+c+'.<span style="color:yellow;background-color:#C526CE;font-weight:normal;border-top: 0px solid #C526CE;border-bottom: 0px solid #C526CE">出口</span>';
		}
	</script>
	
</html>
	

